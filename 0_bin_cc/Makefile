# Identifies all objects based on file names ending with .cc
# Links all binaries based on cc files that end with _bin.cc

CC = g++ -I.
CFLAGS = -MMD -g -Wall -Werror
LDFLAGS = -lm

# Search for all .cc files and create a corresponding .o file.
OBJ_SRC = $(wildcard *.cc)
OBJ = $(OBJ_SRC:%.cc=%.o)

%.o: %.cc
	$(CC) $(CFLAGS) -o $@ -c $<

# Search for all _bin.cc and create a bin target for each.
BIN_SRC = $(filter %_bin.cc, $(OBJ_SRC))
BIN = $(BIN_SRC:.cc=)

%_bin: %_bin.o $(OBJ)
	$(CC) $(LDFLAGS) -o $@ $^

# 'all' target will build all binary targets.
all: $(BIN)

clean:
	rm -rf *.o
	rm -rf *.d
	rm -rf *_bin

# Parse dependencies generated by compiler.
-include $(BIN_SRC:%.cc=%.d)
